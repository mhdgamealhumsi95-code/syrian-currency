<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ù…Ø­ÙˆÙ„ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</title>

    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #013430;
            --gold-color: #C5A065;
            --white-color: #FFFFFF;
            --input-bg: #F5F5F5;
            --btn-hover: #b08d55;
            --red-alert: #d63031;
            --green-success: #00b894;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 20px 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--white-color);
        }

        .eagle-container { margin-bottom: 20px; text-align: center; }
        .eagle-icon { width: 100px; height: auto; fill: var(--gold-color); }

        h1 {
            color: var(--white-color);
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0 0 20px 0;
            text-align: center;
        }

        .card {
            background-color: var(--white-color);
            width: 90%;
            max-width: 640px;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
            text-align: right;
            margin-bottom: 24px;
            color: #013430;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 800;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group { margin-bottom: 14px; }
        .input-label { display:block; margin-bottom:6px; font-weight:700; color:#444; }

        .flex-row { display:flex; gap:10px; align-items:center; }
        input[type="number"], select {
            padding: 12px;
            font-size: 1.05rem;
            border: 2px solid #ddd;
            border-radius: 12px;
            background-color: var(--input-bg);
            font-weight:700;
            outline:none;
            transition: 0.2s;
            text-align: right;
        }

        input[type="number"] { flex: 2; border-color: var(--gold-color); }
        select { flex: 1; border-color: #ccc; cursor:pointer; }

        input:focus, select:focus { box-shadow: 0 0 10px rgba(197,160,101,0.25); }

        .result-box {
            background-color: #f0fdf4;
            border: 2px dashed var(--green-success);
            border-radius: 12px;
            padding: 14px;
            margin-top: 12px;
            display: none;
        }

        .result-text { font-size: 0.98rem; color: #333; margin-bottom:4px; }
        .result-amount { font-size: 1.25rem; font-weight: 800; color: var(--green-success); }

        .error-box {
            background-color: #fff0f0;
            border: 2px solid var(--red-alert);
            color: var(--red-alert);
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
            font-weight: bold;
        }

        .actions-container {
            display:flex;
            justify-content:center;
            gap:10px;
            margin-top:10px;
        }

        .action-btn {
            background-color: var(--gold-color);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .btn-green { background-color: #25D366; }
        .btn-dark { background-color: #333; display: none; }

        @media (max-width: 600px) {
            .flex-row { flex-direction: column; }
            input[type="number"], select { width: 100%; }
        }

        .small-note { font-size:0.85rem; color:#666; margin-top:8px; text-align:right; }

        /* ---------- Ø¥Ø²Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù€ spinner Ù„Ù…Ø¬Ù…Ù„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ---------- */
        /* Chrome, Safari, Edge, Opera */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Firefox */
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>
</head>
<body>

    <div class="eagle-container">
        <!-- Ø§Ø³ØªØ¨Ø¯Ù„ logo.png Ø¨ØµÙˆØ±Ø© ÙØ¹Ù„ÙŠØ© Ø¥Ù† ÙˆÙØ¬Ø¯Øª -->
        <img src="logo.png" class="eagle-icon" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">
    </div>

    <h1>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h1>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ -->
    <div class="card" id="converterCard" aria-label="Ù…Ø­ÙˆÙ„ Ø§Ù„Ù„ÙŠØ±Ø©">
        <div class="card-title">ğŸ”„ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹</div>

        <div class="input-group">
            <label class="input-label" for="oldAmount">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
            <div class="flex-row">
                <input id="oldAmount" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹: 10000" step="1" inputmode="numeric" aria-label="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©">
                <span style="align-self:center; font-weight:700; color:#444">Ù„.Ø³ (Ù‚Ø¯ÙŠÙ…Ø©)</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label" for="newAmount">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
            <div class="flex-row">
                <input id="newAmount" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹: 100" step="0.01" inputmode="decimal" aria-label="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                <span style="align-self:center; font-weight:700; color:#444">Ù„.Ø³ (Ø¬Ø¯ÙŠØ¯Ø©)</span>
            </div>
        </div>

        <div class="small-note">
            * Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©: 1 Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© = 100 Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø©
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ø§Ù‚ÙŠ -->
    <div class="card" id="changeCard" style="border-top: 5px solid var(--gold-color);">
        <div class="card-title">ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ø§Ù‚ÙŠ (ØªØµØ­ÙŠØ­ Ø§Ù„Ø­Ø³Ø¨Ø©)</div>

        <div class="input-group">
            <label class="input-label" for="itemPrice">1. ÙƒÙ… Ø³Ø¹Ø± Ø§Ù„ØºØ±Ø¶ØŸ</label>
            <div class="flex-row">
                <input type="number" id="itemPrice" placeholder="Ù…Ø«Ù„Ø§Ù‹: 8000" step="1" inputmode="numeric" aria-label="Ø³Ø¹Ø± Ø§Ù„ØºØ±Ø¶">
                <select id="priceCurrency" aria-label="Ø¹Ù…Ù„Ø© Ø§Ù„Ø³Ø¹Ø±">
                    <option value="old">Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø©</option>
                    <option value="new">Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label" for="paidAmount">2. ÙƒÙ… Ø¯ÙØ¹Øª Ù„Ù„Ø¨Ø§Ø¦Ø¹ØŸ</label>
            <div class="flex-row">
                <input type="number" id="paidAmount" placeholder="Ù…Ø«Ù„Ø§Ù‹: 100" step="0.01" inputmode="decimal" aria-label="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">
                <select id="paidCurrency" aria-label="Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹">
                    <option value="new">Ù„ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                    <option value="old">Ù„ÙŠØ±Ø© Ù‚Ø¯ÙŠÙ…Ø©</option>
                </select>
            </div>
        </div>

        <div id="resultBox" class="result-box" role="status" aria-live="polite">
            <div class="result-text">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡:</div>
            <div class="result-amount" id="changeNew">0 Ù„.Ø³ (Ø¬Ø¯ÙŠØ¯Ø©)</div>
            <div style="font-size: 0.9rem; color:#666; margin-top:6px;">Ø£Ùˆ Ù…Ø§ ÙŠØ¹Ø§Ø¯Ù„Ù‡Ø§:</div>
            <div class="result-amount" style="color: #013430;" id="changeOld">0 Ù„.Ø³ (Ù‚Ø¯ÙŠÙ…Ø©)</div>
        </div>

        <div id="errorBox" class="error-box" role="alert" aria-live="assertive">
            Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø£Ù‚Ù„ Ù…Ù† Ø³Ø¹Ø± Ø§Ù„ØºØ±Ø¶!
        </div>
    </div>

    <div class="actions-container">
        <button class="action-btn btn-green" id="shareBtn">Ù†Ø´Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ“¢</button>
        <button id="installBtn" class="action-btn btn-dark">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ“²</button>
    </div>

    <div style="text-align:center; margin-top:24px; color: rgba(255,255,255,0.8); font-size:0.9rem;">
        ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Mohamad Alhumsi
    </div>

    <script>
        // ---------- Ø¹Ù†Ø§ØµØ± DOM ----------
        const oldInput = document.getElementById('oldAmount');
        const newInput = document.getElementById('newAmount');

        const itemPriceEl = document.getElementById('itemPrice');
        const priceCurrencyEl = document.getElementById('priceCurrency');
        const paidAmountEl = document.getElementById('paidAmount');
        const paidCurrencyEl = document.getElementById('paidCurrency');

        const resultBox = document.getElementById('resultBox');
        const errorBox = document.getElementById('errorBox');
        const changeNewEl = document.getElementById('changeNew');
        const changeOldEl = document.getElementById('changeOld');

        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ ----------
        // Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØµÙ„ (grouping) ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© >= THRESHOLD_GROUPING
        const THRESHOLD_GROUPING = 100000;

        function formatOld(value) {
            const v = Math.round(Number(value) || 0);
            if (Math.abs(v) >= THRESHOLD_GROUPING) {
                return v.toLocaleString(); // ÙŠØ¸Ù‡Ø± Ø§Ù„ÙÙˆØ§ØµÙ„ Ø­Ø³Ø¨ locale
            }
            return v.toString();
        }

        function formatNew(value) {
            // Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ø´Ø±ÙŠØ© Ø­ØªÙ‰ Ø®Ø§Ù†ØªÙŠÙ†
            let num = Number(value);
            if (isNaN(num)) return '';
            // ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ø®Ø§Ù†ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ† (ØªÙ…Ø«ÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ)
            num = Math.round(num * 100) / 100;
            const abs = Math.abs(num);

            if (Number.isInteger(num)) {
                // Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ -> Ù„Ø§ Ù†Ø¹Ø±Ø¶ .00
                if (abs >= THRESHOLD_GROUPING) return num.toLocaleString();
                return num.toString();
            } else {
                // Ø¹Ø¯Ø¯ Ø¹Ø´Ø±ÙŠ -> Ù†Ù…Ø³Ø­ Ø§Ù„Ø£ØµÙØ§Ø± Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„ÙØ§ØµÙ„Ø© Ø¥Ø°Ø§ ØªØ­Ù‚Ù‚Øª
                if (abs >= THRESHOLD_GROUPING) {
                    return num.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 });
                } else {
                    // Ù†Ø¹Ø±Ø¶ Ø­ØªÙ‰ Ø®Ø§Ù†ØªÙŠÙ†ØŒ ÙˆÙ†Ø­Ø°Ù Ø§Ù„Ø£ØµÙØ§Ø± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
                    let s = num.toFixed(2);
                    s = s.replace(/\.?0+$/,''); // ÙŠØ­Ø°Ù .00 Ø£Ùˆ Ø§Ù„Ø£ØµÙØ§Ø± Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                    return s;
                }
            }
        }

        // ---------- Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© (Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„) ----------
        function convertCurrencyFromOld() {
            if (!oldInput || !newInput) return;
            const val = parseFloat(oldInput.value);
            if (isNaN(val)) {
                newInput.value = '';
                return;
            }
            const result = val / 100;
            // ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù†Ø±ÙŠØ¯ Ù‚ÙŠÙ… "Ù†Ø¸ÙŠÙØ©" Ø¨Ø¯ÙˆÙ† ÙÙˆØ§ØµÙ„ØŒ ÙˆØ¨Ù„Ø§ Ø£ØµÙØ§Ø± Ø²Ø§Ø¦Ø¯Ø©
            newInput.value = Number.isInteger(result) ? String(result) : String(Math.round(result * 100) / 100);
        }

        function convertCurrencyFromNew() {
            if (!oldInput || !newInput) return;
            const val = parseFloat(newInput.value);
            if (isNaN(val)) {
                oldInput.value = '';
                return;
            }
            oldInput.value = String(Math.round(val * 100));
        }

        if (oldInput) oldInput.addEventListener('input', convertCurrencyFromOld);
        if (newInput) newInput.addEventListener('input', convertCurrencyFromNew);

        // ---------- Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ø§Ù‚ÙŠ ----------
        function calculateChange() {
            const price = parseFloat(itemPriceEl?.value);
            const paid = parseFloat(paidAmountEl?.value);
            const priceType = priceCurrencyEl?.value;
            const paidType = paidCurrencyEl?.value;

            if (isNaN(price) || isNaN(paid)) {
                resultBox.style.display = 'none';
                errorBox.style.display = 'none';
                return;
            }

            const priceInOld = (priceType === 'new') ? Math.round(price * 100) : Math.round(price);
            const paidInOld  = (paidType === 'new')  ? Math.round(paid * 100)  : Math.round(paid);

            const changeInOld = paidInOld - priceInOld;

            if (changeInOld < 0) {
                resultBox.style.display = 'none';
                errorBox.style.display = 'block';
                errorBox.innerText = "Ø§Ù†ØªØ¨Ø§Ù‡: Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ØºÙŠØ± ÙƒØ§ÙÙ! (Ù†Ø§Ù‚Øµ " + formatOld(Math.abs(changeInOld)) + " Ù„.Ø³ Ù‚Ø¯ÙŠÙ…Ø©)";
            } else {
                errorBox.style.display = 'none';
                resultBox.style.display = 'block';

                const changeInNew = changeInOld / 100;

                changeNewEl.innerText = formatNew(changeInNew) + " Ù„.Ø³ (Ø¬Ø¯ÙŠØ¯Ø©)";
                changeOldEl.innerText = formatOld(changeInOld) + " Ù„.Ø³ (Ù‚Ø¯ÙŠÙ…Ø©)";
            }
        }

        // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        [itemPriceEl, priceCurrencyEl, paidAmountEl, paidCurrencyEl].forEach(el => {
            if (!el) return;
            el.addEventListener('input', calculateChange);
            if (el.tagName === 'SELECT') el.addEventListener('change', calculateChange);
        });

        // ---------- Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ----------
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            shareBtn.addEventListener('click', () => {
                const shareData = {
                    title: 'Ù…Ø­ÙˆÙ„ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©',
                    text: 'ØªØ·Ø¨ÙŠÙ‚ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø³Ù‡ÙˆÙ„Ø©.',
                    url: window.location.href
                };
                if (navigator.share) {
                    navigator.share(shareData).catch(err => {
                        console.warn('Share failed:', err);
                        alert('ÙØ´Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©. Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹: ' + window.location.href);
                    });
                } else {
                    prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ´Ø§Ø±ÙƒÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹:', window.location.href);
                }
            });
        }

        // ---------- Ø¯Ø¹Ù… ØªØ«Ø¨ÙŠØª PWA (beforeinstallprompt) ----------
        let deferredPrompt = null;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (installBtn) installBtn.style.display = 'inline-block';
        });

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const choiceResult = await deferredPrompt.userChoice.catch(() => ({ outcome: 'dismissed' }));
                if (choiceResult.outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            });
        }

        // ---------- ØªØ³Ø¬ÙŠÙ„ Service Worker (Ù…Ø¹ catch) ----------
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registered:', reg.scope))
                .catch(err => console.warn('Service Worker registration failed:', err));
            });
        }

        // ---------- Ù…Ù†Ø¹ ØªØºÙŠÙŠØ± Ø­Ù‚ÙˆÙ„ number Ø¨Ø¹Ø¬Ù„Ø© Ø§Ù„ÙØ£Ø±Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ±ÙƒÙŠØ² ----------
        document.addEventListener('wheel', function(e) {
            const el = document.activeElement;
            if (el && el.tagName === 'INPUT' && el.type === 'number') {
                e.preventDefault();
            }
        }, { passive: false });

        // ---------- ØªÙ‡ÙŠØ¦Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ----------
        document.addEventListener('DOMContentLoaded', () => {
            try { convertCurrencyFromOld(); } catch (e) {}
            try { calculateChange(); } catch (e) {}
        });
    </script>
</body>
</html>
